% Custom Beamer Style File
\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{mystyle}[2024/12/11 Custom Beamer Style]

% Required packages
\RequirePackage{tikz}
\usetikzlibrary{positioning}
\RequirePackage{xcolor}
\RequirePackage{graphicx}
\usepackage{adjustbox}

% Color definitions
\definecolor{progressblue}{HTML}{00008B}  % Dark Blue
\definecolor{progressgrey}{HTML}{D3D3D3} % Light Grey
\definecolor{footerorange}{HTML}{FFA500} % Orange

% Command for footer text
\newcommand{\footertext}[1]{%
    \gdef\customfoottext{\vspace*{-0.4cm}#1}%
}
\footertext{} % Default empty footer text

% Full-page image title slide with dark orange background
\newcommand{\titlebackground}[1]{%
    {
        \setbeamertemplate{background canvas}{%
            \begin{tikzpicture}[remember picture,overlay]
                % Set dark blue background color for the first slide
                \fill[progressblue] (current page.south west) rectangle (current page.north east);
                \node[anchor=center, opacity=0.9] at (current page.center) {\includegraphics[height=\paperheight]{#1}};
                \node[anchor=north east, xshift=-10pt, yshift=-10pt] at (current page.north east) {\includegraphics[width=150px]{unisa.png}};
            \end{tikzpicture}
        }%
        \begin{frame}[plain]
            \begin{tikzpicture}[remember picture, overlay]
                % Rectangle positioned at x=0, y=50% of the page height
                \path (current page.south west) ++(0, 0.5\paperheight) coordinate (top-left);
                \path (top-left) ++(\paperwidth, -0.25\paperheight) coordinate (bottom-right);

                % Calculate center of the orange rectangle
                \path (top-left) ++(\paperwidth/2, -0.125\paperheight) coordinate (rect-center);

                % Draw rectangle using calculated coordinates with orange fill
                \fill[footerorange, opacity=0.7] (top-left) rectangle (bottom-right);

                % Add text centered in the rectangle
                \node[anchor=center, text width=\paperwidth, align=center, inner sep=1em] at (rect-center) {
                    \color{white}
                    \textbf{\Huge \usebeamerfont{title}\inserttitle}\\[0.5em]
                    \usebeamerfont{author}\insertauthor\\[0.5em]
                    \usebeamerfont{date}\insertdate
                };
            \end{tikzpicture}
        \end{frame}
        \setbeamertemplate{background canvas}[default] % Reset template
    }
}

% Section title page with subtle blue tint
\newcommand{\makesection}[1]{%
    \begin{frame}[plain]
        \begin{tikzpicture}[remember picture,overlay]
            % Orange background
            \fill[footerorange,opacity=0.9] (current page.south west) rectangle (current page.north east);

            % Progress bar at the bottom
            \fill[progressgrey] (current page.south west) rectangle ([xshift=\paperwidth, yshift=0.05cm]current page.south west);
            \fill[progressblue] (current page.south west) rectangle
                  ([xshift={\paperwidth * \insertframenumber / \inserttotalframenumber}, yshift=0.05cm]current page.south west);
        \end{tikzpicture}
        \begin{center}
            \usebeamerfont{frametitle}
            \Large\textbf{#1}
        \end{center}
    \end{frame}
}

% Add footer and progress bar to footline
% In unisa.sty, replace the footline definition with:
\makeatletter
\setbeamertemplate{footline}{%
    \begin{beamercolorbox}[wd=\paperwidth,ht=0.7cm,dp=0.3cm,leftskip=0.3cm,rightskip=0.3cm]{footerorange}
        % Use a simpler approach with just one minipage for the footnote text
        \begin{minipage}[t]{0.8\paperwidth}
            \raggedright
            \usebeamerfont{footline}\ifx\customfoottext\@empty\hspace{0pt}\else\customfoottext\fi
        \end{minipage}%
        % Position the page number and logo on the right using \hfill
        \hfill
        \raisebox{-0.25cm}[0cm][0cm]{\insertframenumber{} of \inserttotalframenumber\includegraphics[height=0.85cm]{unisa_color.png}}
    \end{beamercolorbox}%
    \begin{tikzpicture}[remember picture,overlay]
        \fill[progressgrey] (0,0) rectangle (\paperwidth,0.05cm);
        \fill[progressblue] (0,0) rectangle ({\paperwidth * \insertframenumber / \inserttotalframenumber},0.05cm);
    \end{tikzpicture}%
}
\makeatother


% Color theme
\setbeamercolor{background canvas}{bg=white}
\setbeamercolor{footerorange}{fg=black,bg=footerorange}
\setbeamercolor{progressblue}{bg=progressblue}
\setbeamercolor{progressgrey}{bg=progressgrey}
\setbeamercolor*{normal text}{fg=black}
\setbeamercolor*{alerted text}{fg=red}
\setbeamercolor*{example text}{fg=green!50!black}

\mode<presentation>

\endinput
