% Custom Beamer Style File
\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{mystyle}[2024/12/11 Custom Beamer Style]

% Required packages
\RequirePackage{tikz}
\usetikzlibrary{positioning}
\RequirePackage{xcolor}
\RequirePackage{graphicx}
\usepackage{adjustbox}

% Color definitions
\definecolor{progressblue}{HTML}{00008B}  % Dark Blue
\definecolor{progressgrey}{HTML}{D3D3D3} % Light Grey
\definecolor{footerorange}{HTML}{FFA500} % Orange

% Command for footer text that handles citations properly
\newcommand{\footertext}[1]{%
    \gdef\customfoottext{\vspace*{-0.4cm}#1}%
}

% Command for footer citations only
\newcommand{\footfullcite}[1]{%
    \footertext{\fullcite{#1}}%
}

% Remove navigation symbols
\setbeamertemplate{navigation symbols}{}

% Command for both inline citation and footer full citation
\newcommand{\citewithfooter}[1]{%
    \cite{#1}%
    \footertext{\fullcite{#1}}%
    \only<1>{\gdef\shouldclearfooter{true}}%
}

% Hook to clear footer at frame start
\BeforeBeginEnvironment{frame}{%
    \ifcsdef{shouldclearfooter}{%
        \clearfooter%
        \csundef{shouldclearfooter}%
    }{}%
}

% Command to clear footer text
\newcommand{\clearfooter}{%
    \footertext{}%
}

% Override footnote to work with footer
\renewcommand{\footnote}[1]{%
    \footertext{#1}%
}

\footertext{} % Default empty footer text

% Full-page image title slide with dark orange background
\newcommand{\titlebackground}[1]{%
    {
        \setbeamertemplate{background canvas}{%
            \begin{tikzpicture}[remember picture,overlay]
                % Set dark blue background color for the first slide
                \fill[progressblue] (current page.south west) rectangle (current page.north east);
                \node[anchor=center, opacity=0.9] at (current page.center) {\includegraphics[height=\paperheight]{#1}};
                \node[anchor=north west, xshift=8pt, yshift=0pt] at (current page.north west) {\includegraphics[width=48px]{unisa_written_logo}};


                \node[anchor=south east, xshift=-60pt, yshift=10pt] at (current page.south east) {\includegraphics[width=35px]{doinf}};
                \node[anchor=south east, xshift=-8pt, yshift=12pt] at (current page.south east) {\includegraphics[width=48px]{isslab}};
                \node[anchor=south east, xshift=-100pt, yshift=10pt] at (current page.south east) {\includegraphics[width=35px]{unisa.png}};
            \end{tikzpicture}
        }%
        \begin{frame}[plain]
            \begin{tikzpicture}[remember picture, overlay]
                % Create the text content first to measure its height
                \node[anchor=center, text width=0.9\paperwidth, align=center, inner sep=1.5em] at (current page.center) (textbox) {
                    \color{white}
                    \textbf{\Huge \usebeamerfont{title}\inserttitle}\\[0.5em]
                    \usebeamerfont{author}\insertauthor\\[0.5em]
                    \usebeamerfont{date}\insertdate
                };

                % Draw the orange background with full page width but fitting text height
                \fill[footerorange, opacity=0.7] (current page.west |- textbox.south) rectangle (current page.east |- textbox.north);

                % Redraw the text on top of the background
                \node[anchor=center, text width=0.9\paperwidth, align=center, inner sep=1.5em] at (current page.center) {
                    \color{white}
                    \textbf{\Huge \usebeamerfont{title}\inserttitle}\\[0.5em]
                    \usebeamerfont{author}\insertauthor\\[0.5em]
                    \usebeamerfont{date}\insertdate
                };
            \end{tikzpicture}
        \end{frame}
        \setbeamertemplate{background canvas}[default] % Reset template
    }
}

% Section title page with subtle blue tint
\newcommand{\makesection}[1]{%
    \begin{frame}[plain]
        \begin{tikzpicture}[remember picture,overlay]
            % Orange background
            \fill[footerorange,opacity=0.9] (current page.south west) rectangle (current page.north east);

            % Progress bar at the bottom
            \fill[progressgrey] (current page.south west) rectangle ([xshift=\paperwidth, yshift=0.05cm]current page.south west);
            \ifnum\insertframenumber>1
                \fill[progressblue] (current page.south west) rectangle
                      ([xshift={\paperwidth * (\insertframenumber - 1) / (\inserttotalframenumber - 1)}, yshift=0.05cm]current page.south west);
            \fi
        \end{tikzpicture}
        \begin{center}
            \usebeamerfont{frametitle}
            \Large\textbf{#1}
        \end{center}
    \end{frame}
}

% Add footer and progress bar to footline
\makeatletter
\setbeamertemplate{footline}{%
    \begin{beamercolorbox}[wd=\paperwidth,ht=0.7cm,dp=0.3cm,leftskip=0.3cm,rightskip=0.3cm]{footerorange}
        % Logo on the far left
        \raisebox{-0.25cm}[0cm][0cm]{\includegraphics[height=0.85cm]{unisa.png}}%
        % Footnote text positioned to the right of logo with spacing, left-aligned but vertically centered
        \hspace{0.5cm}%
        \begin{minipage}[c][0.7cm][c]{0.75\paperwidth}
            \raggedright
            \usebeamerfont{footline}\ifx\customfoottext\@empty\hspace{0pt}\else\customfoottext\fi
        \end{minipage}%
        % Push page number to the right and align higher
        \hfill
        \raisebox{-0.1cm}[0cm][0cm]{\usebeamerfont{footline}\insertframenumber}
    \end{beamercolorbox}%
    \begin{tikzpicture}[remember picture,overlay]
        \fill[progressgrey] (0,0) rectangle (\paperwidth,0.05cm);
        \ifnum\insertframenumber>1
            \fill[progressblue] (0,0) rectangle ({\paperwidth * (\insertframenumber - 1) / (\inserttotalframenumber - 1)},0.05cm);
        \fi
    \end{tikzpicture}%
}
\makeatother

% Color theme
\setbeamercolor{background canvas}{bg=white}
\setbeamercolor{footerorange}{fg=black,bg=footerorange}
\setbeamercolor{progressblue}{bg=progressblue}
\setbeamercolor{progressgrey}{bg=progressgrey}
\setbeamercolor*{normal text}{fg=black}
\setbeamercolor*{alerted text}{fg=red}
\setbeamercolor*{example text}{fg=green!50!black}

\mode<presentation>

\endinput
